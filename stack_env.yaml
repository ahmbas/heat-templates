parameters:
  user_data: |
    #!/bin/bash
    yum install -y yum-utils device-mapper-persistent-data lvm2
    yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
    yum install -y docker-ce

    cat <<EOT > /etc/docker/daemon.json
    {
      "storage-driver": "devicemapper",
      "storage-opts": [
        "dm.directlvm_device=/dev/vdb"
      ]
    }
    EOT


    fdisk /dev/vdc <<EOF
    n
    p
    1


    w
    EOF

    mkdir /http_files/
    mkfs.ext4 /dev/vdc1
    echo "/dev/vdc1 /http_files/ ext4 defaults 0 0" >> /etc/fstab
    mount /dev/vdc1 /http_files/

    echo "assignment done!" >> /http_files/index.html
    systemctl enable --now docker
    docker run -dit -v /http_files/:/usr/local/apache2/htdocs -p 80:80 httpd
