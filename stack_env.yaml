parameters:
  user_data: |
    #!/bin/bash
    setenforce 0
    yum install -y yum-utils device-mapper-persistent-data lvm2
    yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
    yum install -y docker-ce

    mkdir /etc/docker
    echo '{"storage-driver": "devicemapper", "storage-opts": ["dm.directlvm_device=/dev/vdb"]}' > /etc/docker/daemon.json

    fdisk /dev/vdc <<EOF
    n
    p
    1


    w
    EOF

    mkdir /http_files/
    mkfs.ext4 /dev/vdc1
    echo "/dev/vdc1 /http_files/ ext4 defaults 0 0" >> /etc/fstab
    mount /dev/vdc1 /http_files/

    echo "All good!" >> /http_files/index.html
    systemctl enable --now docker
    docker run -dit -v /http_files/:/usr/local/apache2/htdocs -p 80:80 httpd
